<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoApp</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    h1 { font-size: 1.5em; }
    button { padding: 10px 20px; font-size: 1em; }
    pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
    /* Added style for version info */
    #version-info { font-size: 0.8em; color: #666; text-align: center; margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee; }
  </style>
</head>
<body>
  <h1 id="app-name">GeoApp</h1>
  <p>Tap the button to get your address via Nominatim (no key required).</p>
  <button id="locateBtn">Get Address</button>
  <pre id="result"></pre>
  <!-- Added element for version info -->
  <p id="version-info"></p>

  <script>
    // --- START: Version Information ---
    // IMPORTANT: Manually update this value when you push new changes to GitHub.
    // You can use a date, a version number, or a combination.
    // Example: "v1.0.1 - 2024-03-15 14:30 UTC" or "V5"
    const appDisplayVersion = "V5"; // <-- MANUALLY EDIT THIS LINE (or as requested)
    document.getElementById('version-info').textContent = appDisplayVersion;
    // --- END: Version Information ---

    // Generate an app name based on the User-Agent
    function getAppName() {
      const ua = navigator.userAgent;
      let device = 'Web';
      if (/iPhone/.test(ua)) device = 'iPhone';
      else if (/iPad/.test(ua)) device = 'iPad';
      else if (/Android/.test(ua)) device = 'Android';
      else if (/Windows/.test(ua)) device = 'Windows PC';
      else if (/Mac/.test(ua)) device = 'Mac';
      let browser = 'Browser';
      if (/Safari/.test(ua) && !/Chrome/.test(ua)) browser = 'Safari';
      else if (/Chrome/.test(ua)) browser = 'Chrome';
      else if (/Firefox/.test(ua)) browser = 'Firefox';
      else if (/OPR|Opera/.test(ua)) browser = 'Opera';
      return `${device} ${browser} GeoApp`;
    }
    document.getElementById('app-name').textContent = getAppName();

    const resultEl = document.getElementById('result');
    document.getElementById('locateBtn').addEventListener('click', () => {
      if (!navigator.geolocation) {
        resultEl.textContent = 'Geolocation not supported by your browser.';
        return;
      }
      resultEl.textContent = 'Locating…';
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        try {
          const resp = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`
          );
          if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
          const data = await resp.json();
          const address = data.display_name || JSON.stringify(data.address, null, 2);
          resultEl.textContent = `Coordinates: ${lat}, ${lon}\nAddress: ${address}`;
        } catch (fetchErr) {
          resultEl.textContent = 'Error fetching address: ' + fetchErr.message;
        }
      }, (err) => {
        let message = 'Error getting location: ' + err.message;
        if (err.code === 1) { // PERMISSION_DENIED (err.PERMISSION_DENIED)
          let helpText = "Error: Geolocation permission denied by you or your device settings.\n\n";
          helpText += "To enable location access for this page (" + window.location.hostname + "), please check the following and then tap 'Get Address' again:\n\n";

          helpText += "IPHONE/IPAD (iOS):\n";
          helpText += "1. Go to: iPhone Settings > Privacy & Security > Location Services.\n";
          helpText += "   - Ensure 'Location Services' (at the top) is ON.\n";
          helpText += "   - Scroll down to find your browser ('Safari Websites', 'Chrome', 'Firefox') in the app list and tap it.\n";
          helpText += "   - Select 'Ask Next Time Or When I Share' or 'While Using the App'.\n";
          helpText += "2. If using Safari, ALSO check: iPhone Settings > Safari (scroll down to 'SETTINGS FOR WEBSITES') > Location.\n";
          helpText += "   - Ensure '" + window.location.hostname + "' is not set to 'Deny'. Set to 'Ask' or 'Allow'.\n\n";

          helpText += "ANDROID:\n";
          helpText += "1. In your Browser (e.g., Chrome, Firefox):\n";
          helpText += "   - Tap the menu (usually ⋮ or ☰) > Settings (or 'Settings and privacy').\n";
          helpText += "   - Look for 'Site settings' (or 'Permissions') > 'Location'.\n";
          helpText += "   - Find this site ('" + window.location.hostname + "') in the list (you might need to check 'Blocked').\n";
          helpText += "   - Ensure its permission is set to 'Allow' or 'Ask'.\n";
          helpText += "2. OR, in Android System Settings:\n";
          helpText += "   - Go to: System Settings > Location (ensure 'Use location' or 'Location access' is ON).\n";
          helpText += "   - Then: System Settings > Apps > See all apps > [Your Browser App] > Permissions > Location.\n";
          helpText += "   - Select 'Allow only while using the app' or 'Ask every time'.\n\n";
          message = helpText;
        } else if (err.code === 2) { // POSITION_UNAVAILABLE
          message = 'Error: Location information is unavailable. Please ensure your location services are enabled and try again.';
        } else if (err.code === 3) { // TIMEOUT
          message = 'Error: The request to get user location timed out. Please try again.';
        }
        resultEl.textContent = message;
      }, {
        enableHighAccuracy: true,
        timeout: 10000
      });
    });
  </script>
</body>
</html>
